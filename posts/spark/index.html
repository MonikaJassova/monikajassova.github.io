<!DOCTYPE html><html class="no-js" domain="github.io" lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><link href="/img/favicon/favicon-192x192.png?hash=f78a2bf32c" rel="icon" type="image/png"><meta content="79b473" name="theme-color" media="(prefers-color-scheme: light)"><meta content="f9c412" name="theme-color" media="(prefers-color-scheme: dark)"><meta content="max-snippet:-1, max-image-preview: large, max-video-preview: -1" name="robots"><title>Apache Spark</title><meta content="Apache Spark" property="og:title"><meta content="Prehƒæad Apache Spark" name="description"><meta content="Prehƒæad Apache Spark" property="og:description"><meta content="https://monikajassova.github.io/img/remote/1TpY4k.png" property="og:image"><link href="https://monikajassova.github.io/posts/spark/" rel="canonical"><meta content="no-referrer-when-downgrade" name="referrer"><link href="/feed/feed.xml" rel="alternate" type="application/atom+xml" title="Domov"><link href="/" rel="preconnect" crossorigin=""><link href="/fonts/Inter-3.19.var.woff2" rel="preload" type="font/woff2" as="font" crossorigin=""><script csp-hash="sha256-XwWdy3h8RLzX10dUs9n/fCAkQc+XFysyIb7c80Ymdkw=">document.documentElement.classList.remove("no-js");</script><script async="" defer="" src="/js/min.js?hash=639a113458"></script><script async="" defer="" src="/js/goatCounter.js" data-goatcounter="https://miti.goatcounter.com/count"></script><script csp-hash="sha256-dV8AqTFq+DEHvrcvFtA7Q4feFxe8sPFUc57DVH84EjE=">(function (){const docElm=document.documentElement; const modeKey="colorscheme-mode"; let mode=undefined; try{mode=window.localStorage.getItem(modeKey); if (mode){docElm.setAttribute(modeKey, mode);}else{mode=((window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) ? "light" : "dark"); docElm.setAttribute(modeKey, mode); window.localStorage.setItem(modeKey, mode);}}catch (exception){mode=((window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) ? "light" : "dark"); docElm.setAttribute(modeKey, mode);}})()</script><script csp-hash="sha256-Ky9qZOPnMhQV/s7Fdb9TYAOfU4KtWNqCZaFK8tSzXa0=">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--switch-shadow-color: #f7f7f7;--switch-icon: "üåö";--switch-text: "Tmav√Ω?";--text-color: #222222;--bg-color: #f7f7f7;--theme-color: #79b473;--primary: var(--theme-color);--primary-dark: #89b485}:root[colorscheme-mode=dark]{--switch-shadow-color: #0e0d0c;--switch-icon: "üåù";--switch-text: "Svetl√Ω?";--text-color: #e5e5e5;--bg-color: #181818;--theme-color: #f9c412;--primary: var(--theme-color);--primary-dark: #e7bf60}@media (prefers-color-scheme:light){:root:not([colorscheme-mode=dark]){--switch-shadow-color: #f7f7f7;--switch-icon: "üåö";--switch-text: "Tmav√Ω?";--text-color: #222222;--bg-color: #f7f7f7;--theme-color: #79b473;--primary: var(--theme-color);--primary-dark: #89b485}}@media (prefers-color-scheme:dark){:root:not([colorscheme-mode=light]){--switch-shadow-color: #0e0d0c;--switch-icon: "üåù";--switch-text: "Svetl√Ω?";--text-color: #e5e5e5;--bg-color: #181818;--theme-color: #f9c412;--primary: var(--theme-color);--primary-dark: #e7bf60}}.no-js .colorscheme-toggle-label{display:none}.colorscheme-toggle-label{--transition-time: 0.3s;cursor:pointer;display:inline-block;transition:all var(--transition-time) ease-in-out;transform:scale(1.2)}.colorscheme-toggle-label::before{content:var(--switch-icon);transition:text-shadow var(--transition-time);text-shadow:0 0 10px var(--switch-shadow-color)}.colorscheme-toggle-label::after{align-self:center;vertical-align:baseline;content:var(--switch-text);color:#222;font-weight:lighter;font-size:.75em;text-align:center;opacity:0;padding-left:15x;margin-left:10px;transition:opacity var(--transition-time)}.colorscheme-toggle-label:hover::before{text-shadow:0 0 10px var(--switch-shadow-color)}.colorscheme-toggle-label:hover::after{opacity:1}main img{content-visibility:auto}article *{scroll-margin-top:50px}header nav{z-index:1;position:fixed;top:0;left:0;width:100vw;padding:.375em 1.5em;background:rgba(255,255,255,.9);font-weight:200;text-align:right}:root{--main-width: calc(100vw - 3em)}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)}}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px}share-widget div{width:30px;height:30px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center}.apple share-widget div{background-image:url(/img/share-apple.svg)}body,share-widget button{margin:0}share-widget button:active{transform:scale(1.2)}dialog{background-color:#ab7390;z-index:1000}header aside{font-style:italic}#nav{z-index:2;position:relative}#reading-progress{z-index:1;background-color:var(--primary);width:100vw;position:absolute;left:0;top:0;bottom:0;transform:translate(-100vw,0);will-change:transform;pointer-events:none}#posts li{margin-bottom:.5em}@font-face{font-display:optional;font-family:"Inter UI";font-weight:100 900;font-style:oblique 0deg 10deg;src:url(/fonts/Inter-3.19.var.woff2) format("woff2")}button,html{line-height:1.15}html{-webkit-text-size-adjust:100%;font-family:Inter UI,sans-serif;--font-family: Inter UI, sans-serif}body{transition:all 300ms ease-in-out 0s}h1{font-size:3em;line-height:1.25;margin:.67em 0 .5em;font-size:2.074rem;line-height:2.4rem;margin-bottom:1.36rem}a{background-color:transparent;color:#f9c412;text-decoration:none;color:var(--primary)}b{font-weight:700}img{border-style:none;max-width:100%;height:auto;margin:0 auto}button{font-family:inherit;font-size:100%;overflow:visible;text-transform:none}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}h3{font-size:2em;line-height:1.125;margin-bottom:.75em;font-size:1.4rem}h4{font-size:1.5em;margin-bottom:1em;line-height:1.5em}body,ol,p,pre,ul{font-size:1em}ol,p,pre,ul{margin-bottom:1.5em}h3,h4{line-height:1.6rem;margin-bottom:1.36rem}h4{font-size:1.2rem}body,ol,p,pre,ul{font-size:1rem;line-height:1.6}ol,p,pre,ul{margin-bottom:1.36rem}@media (min-width:600px){h1{font-size:4.3978rem;line-height:4.4rem}h3{font-size:2.1989rem;line-height:2.64rem}h4{font-size:1.5554rem;line-height:1.76rem}body,ol,p,pre,ul{font-size:1.1rem;line-height:1.6}h1,h3,h4,ol,p,pre,ul{margin-bottom:1.496rem}}@media (min-width:1200px){h1{font-size:6.0756rem;line-height:6.72rem}h3{font-size:2.7rem;line-height:2.88rem}h4{font-size:1.8rem;line-height:1.92rem}body,ol,p,pre,ul{font-size:1.2rem;line-height:1.6}h1,h3,h4,ol,p,pre,ul{margin-bottom:1.632rem}}table{display:table}code,pre,table{overflow-x:auto}pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}pre code:not([class]){padding:1.5em;overflow-x:scroll}button,code{border-radius:.3em}code,mark{padding:0 .3em}code{color:#e2777a;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%;background:#2d2d2d}mark{background:#f9c412;background:var(--primary)}h1,h3,h4{font-family:var(--font-family)}h4{font-style:italic}a:hover{text-decoration:underline}dt{font-weight:600;padding-top:.75em;padding-left:.75em}button{max-width:100%;background:#f2f2f2;color:#191919;cursor:pointer;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button+label,label+*{page-break-before:always}button,label{display:inline-block}button:hover{background:#d9d9d9;color:#000}button:not([disabled]){background:#f9c412;color:#181818;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}*{border:0;box-sizing:border-box}body,header nav a{font-family:var(--font-family)}body{background:var(--bg-color);color:var(--text-color)}header label{display:block}header{padding:4.5em 1.5em 3em;width:37.5em;margin:0 auto;text-align:center;max-width:100%;display:flex;align-items:center;flex-direction:column}header p,ol,ul{margin-top:0}header nav h1{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav a{font-weight:700;text-decoration:none;color:#181818;margin-left:1.5em}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}header nav label{color:#000;cursor:pointer;margin:0;font-style:normal;text-align:right}main{max-width:70rem;margin:0 auto;border-top:.5px solid #ccc;text-align:justify}footer{background:rgba(0,0,0,.8);color:#fff;padding:3em;text-align:center}footer>*{margin:1.5em}footer nav a img{vertical-align:middle}footer nav,footer p{font-size:90%}article{max-width:100%;padding:1.5em;width:40em;margin:0 auto}li ol,li ul{margin-bottom:0}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]{padding:0}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.punctuation{color:#ccc}.token.boolean,.token.function{color:#f08d49}.token.property{color:#f8c555}.token.string{color:#7ec699}.token.operator,.token.url{color:#67cdcc}.token.inserted{color:green}</style></head><body><header><nav><div id="nav"><h1><a href="/" title="Homepage">Domov</a> <label class="colorscheme-toggle-label" id="colorscheme-toggle" on-click="colorscheme-toggle"></label></h1><a href="/tags/">Tagy</a> <a href="/about/">O mne</a></div><div id="reading-progress" aria-hidden="true"></div></nav><h1>Apache Spark</h1><aside>ƒç√≠tanie na 7 min</aside><dialog id="message"></dialog><noscript><img src="https://miti.goatcounter.com/count?p=/test-noscript"></noscript></header><main><article><p><em>Zbe≈æn√Ω prehƒæad fungovania Apache Spark</em></p><p><a href="https://spark.apache.org">Apache Spark</a> je jedn√Ωm z najpou≈æ√≠vanej≈°√≠ch n√°strojov pre anal√Ωzu d√°t vo veƒækej ≈°k√°le (big data), rie≈°i situ√°ciu, keƒè s√∫ d√°ta tak√© veƒæk√©, ≈æe ich ulo≈æenie a spracovanie nedok√°≈æe jeden poƒç√≠taƒç. Zvl√°da d√°vkov√© (batch) spracov√°vanie d√°t, spracov√°vanie d√°t v re√°lnom ƒçase (streaming), interakt√≠vne dotazovanie, v√Ωpoƒçty a oper√°cie s grafom a strojov√© uƒçenie (machine learning).<br>Ide o open-source framework na spracovanie d√°t, ktor√Ω dok√°≈æe r√Ωchlo vykon√°va≈• procesovacie √∫lohy nad veƒæmi veƒæk√Ωmi mno≈æinami d√°t a tie≈æ dok√°≈æe tieto √∫lohy distribuova≈• medzi viacero poƒç√≠taƒçov, ktor√© ich paralelne a nez√°visle od seba sprac√∫vaj√∫. Pre svoje fungovanie vy≈æaduje mana≈æ√©r clustera poƒç√≠taƒçov (napr. Hadoop YARN - Yet Another Resource Negotiator) a distribuovan√Ω syst√©m s√∫borov (napr. HDFS - Hadoop Distributed File System).<br>Obr√°zok zn√°zor≈àuje 4 kni≈ænice pre r√¥zne √∫ƒçely a programovacie jazyky, ktor√© podporuje z√°kladn√© API:</p><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/SparkEcosystem-1920w.avif 1920w, /img/SparkEcosystem-1280w.avif 1280w, /img/SparkEcosystem-640w.avif 640w, /img/SparkEcosystem-320w.avif 320w" type="image/avif"><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/SparkEcosystem-1920w.webp 1920w, /img/SparkEcosystem-1280w.webp 1280w, /img/SparkEcosystem-640w.webp 640w, /img/SparkEcosystem-320w.webp 320w" type="image/webp"><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/SparkEcosystem-1920w.png 1920w, /img/SparkEcosystem-1280w.png 1280w, /img/SparkEcosystem-640w.png 640w, /img/SparkEcosystem-320w.png 320w" type="image/png"><img src="/img/SparkEcosystem-1920w.png" alt="Spark Ecosystem" decoding="async" height="341" loading="lazy" style="background-size:cover;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 701 341'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAFCAYAAACTphZWAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1ElEQVQImR3MzUoCYRxG8SeCyKGMShFq16JFdAsF0ZWUOWJRbw424iIIadc3Bm3DjdCHCUEtBqK7SbuConf+J5jl+S2OXMBflIfdMV5cYD8uh9VEP5oBl7PhYUDSLEF9mi/Vp/CNWdgb5zEu8tuYg/0JHlqLxtE8w7hg7+0VaJYYqSKey2JQFZ0d8VQV/VB0KrJBWfRCcbctXkNxryhvaVyAg0loLcDJMpyuwvFSdss8LoIL+FZ3C5+cm11vmH9rk16uk35c4S/WSD9vs/bJGdxsMvoH2wOIEgOT6/0AAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&quot;)" width="701"></picture></p><p>Spark je nap√≠san√Ω v programovacom jazyku <a href="https://www.scala-lang.org">Scala</a>, prv√° verzia vy≈°la v roku 2010 (od 2014 pod hlaviƒçkou firmy Apache) a najnov≈°ia verzia je 3.2.1 z janu√°ra 2022.<br>Spoƒçiatku sa Spark vyu≈æ√≠val na vlastnom "≈æeleze" - firmy vlastnili a starali sa o svoje Hadoop clustere, v dne≈°nej dobe cloudu sa u≈æ poskytuje ako mana≈æovan√° alebo serverless slu≈æba, menovite <a href="https://aws.amazon.com/emr">Amazon EMR</a>, <a href="https://azure.microsoft.com/en-us/services/databricks">Azure Databricks</a> alebo <a href="https://cloud.google.com/solutions/spark">Spark on Google Cloud</a>, tak≈æe pou≈æ√≠vateƒæom odpad√° staros≈• o mana≈æovanie clustera.</p><h3 id="spark-core">Spark Core <a href="#spark-core" class="direct-link">#</a></h3><p>Je z√°kladn√Ωm kame≈àom Sparku a ide o rozhranie pre programovanie aplik√°ci√≠ s√∫streden√© okolo abstrakcie naz√Ωvanej RDD.<br>Najprv v≈°ak pribl√≠≈æim 2 procesy, ktor√© na≈°tartuje Spark cluster po spusten√≠ Spark aplik√°cie:</p><ul><li><mark>driver</mark> je hlavn√Ω, riadiaci proces zodpovedn√Ω za vytvorenie Spark contextu, preklad k√≥du Spark aplik√°cie na logick√Ω pl√°n DAG a n√°sledne na v√Ωpoƒçtov√© jednotky, √∫lohy, ktor√© s√∫ distribuovan√© medzi pracovn√© uzly (worker nodes). Taktie≈æ koordinuje rozvrhnutie √∫loh a orchestr√°ciu na ka≈ædom exek√∫tore.</li><li><mark>exek√∫tory</mark> be≈æia na pracovn√Ωch uzloch clustra a s√∫ zodpovedn√© za v√Ωkon im pridelen√Ωch v√Ωpoƒçtov√Ωch √∫loh, vr√°tenie v√Ωsledkov driveru a tie≈æ poskytnutie √∫lo≈æiska pre RDD. Medziv√Ωsledky jednotliv√Ωch oper√°ci√≠ sa dr≈æia v distribuovanej pam√§ti, neukladaj√∫ sa na disk (len ak sa nevojd√∫ do RAM), preto s√∫ veƒæmi r√Ωchle.</li></ul><p>Pr√°ve pre sprostredkovanie medzi t√Ωmito procesmi je potrebn√° nejak√° forma cluster mana≈æ√©ra - okrem spom√≠nan√©ho YARNu sa nov≈°ie pou≈æ√≠va <a href="https://spark.apache.org/docs/latest/running-on-kubernetes.html">Kubernetes</a>.</p><h4 id="spark-rdd">Spark RDD <a href="#spark-rdd" class="direct-link">#</a></h4><p>Resilient Distributed Dataset (RDD) je abstrakcia reprezentuj√∫ca nemenn√∫ kolekciu objektov, ktor√° m√¥≈æe by≈• rozdistribuovan√° medzi v√Ωpoƒçtov√Ω cluster. Oper√°cie nad RDD sa tie≈æ daj√∫ rozdeli≈• medzi uzly clustera a s√∫ vykon√°van√© v paralelnom d√°vkovom procese, ƒço vedie k r√Ωchlemu a ≈°k√°lovateƒæn√©mu procesovaniu.</p><p>Spark RDD API uv√°dza niekoƒæko transform√°ci√≠ a akci√≠ pre manipul√°ciu s RDD:</p><ul><li>Transform√°cie RDD vracaj√∫ v≈ædy nov√Ω RDD a umo≈æ≈àuj√∫ vytvori≈• z√°vislosti medzi RDD. Ka≈æd√Ω RDD v re≈•azi z√°vislost√≠ m√° funkciu na v√Ωpoƒçet svojich d√°t a smern√≠k na svoj rodiƒçovsk√Ω RDD. Transform√°cia RDD je krok v programe hovoriaci Sparku ako z√≠ska≈• d√°ta a ƒço s nimi robi≈•.</li><li>Akcie nad RDD vracaj√∫ samotn√Ω v√Ωsledok, hodnotu (napr. reduce, count, collect). V√Ωsledok m√¥≈æe by≈• ulo≈æen√Ω na disk, zap√≠san√Ω do datab√°zy alebo vyp√≠san√Ω do konzoly. RDD s√∫ vyhodnocovan√© odlo≈æene (lenivo - lazy evaluation), vyhodnotenie sa nezaƒçne, k√Ωm nie je zavolan√° nejak√° akcia.</li></ul><p>Resilient - odoln√Ω alebo schopn√Ω obnovi≈• ƒçinnos≈• - znamen√°, ≈æe ak v niektorom kroku procesu oper√°cia/exek√∫tor spadne, nie je to ≈æiaden probl√©m a potrebn√Ω RDD sa obnov√≠ zo vstupn√Ωch d√°t a danou re≈•azou z√°vislost√≠ a transform√°ci√≠. Beh Spark aplik√°cie m√¥≈æe pokraƒçova≈•, celkov√© spracovanie d√°t nie je ohrozen√© a je teda odoln√© voƒçi zlyhaniam.</p><p>Prvotn√Ω RDD sa vytvor√≠ paraleln√Ωm naƒç√≠tan√≠m d√°t do zvl√°≈°tnych part√≠ci√≠ na jednotliv√Ωch pracovn√Ωch uzloch. Takto m√° ka≈æd√Ω uzol in√∫ podmno≈æinu d√°t - logick√∫ ƒças≈• veƒækej distribuovanej mno≈æiny d√°t. Exek√∫tory obdr≈æia na spracovanie jednu alebo viac part√≠ci√≠. Exek√∫tor vykon√°va v danom ƒçase v≈ædy len jednu √∫lohu pre dan√∫ part√≠ciu. Rozhodovanie o poƒçte part√≠ci√≠ je hƒæadanie kompromisu: ak rozdel√≠me RDD na veƒæa men≈°√≠ch part√≠ci√≠, rozvrhovanie √∫loh m√¥≈æe zabra≈• viac ƒçasu ako samotn√Ω v√Ωpoƒçet a na druhej strane m√°lo veƒæk√Ωch part√≠ci√≠ m√¥≈æe znamena≈•, ≈æe ned√¥jde k vy≈•a≈æeniu v≈°etk√Ωch pracovn√Ωch uzlov a nevyu≈æij√∫ sa tak v√Ωhody paralelizmu.</p><p>RDD m√¥≈æu by≈• vytvoren√© dvomi sp√¥sobmi:</p><ol><li>odkazovan√≠m sa na s√∫bor d√°t v externom √∫lo≈ænom syst√©me, ako je zdieƒæan√Ω s√∫borov√Ω syst√©m, HDFS, HBase, jednoduch√Ω textov√Ω s√∫bor, SQL datab√°za, NoSQL sklad (ako Cassandra a MongoDB), bucket na √∫lo≈æisku Amazon S3 a veƒæa in√Ωch,</li><li>paralelizovan√≠m existuj√∫cej kolekcie v programe drivera - aplikovan√≠m transform√°ci√≠ na existuj√∫cich RDD. Okrem tradiƒçnej map and reduce funkcionality m√° Spark tie≈æ vstavan√∫ podporu pre sp√°janie data setov, filtrovanie a agreg√°cie.</li></ol><h4 id="dag">DAG <a href="#dag" class="direct-link">#</a></h4><p>Druhou hlavnou abstrakciou v Sparku je DAG (directed acyclic graph). Spark definuje √∫lohy, ktor√© m√¥≈æu by≈• paralelne vypoƒç√≠tan√© nad part√≠ciami d√°t v clusteri. Zostroj√≠ logick√Ω tok oper√°ci√≠, ktor√Ω je reprezentovan√Ω ako riaden√Ω acyklick√Ω graf, kde uzly predstavuj√∫ RDD part√≠cie a hrany transform√°cie d√°t.<br>Logick√Ω pl√°n DAGu sa podƒæa povahy transform√°ci√≠ skonvertuje na <mark>fyzick√Ω exekuƒçn√Ω pl√°n</mark> pozost√°vaj√∫ci z et√°p (stages). √ölohy v ka≈ædej etape sa zbalia spolu a po≈°l√∫ exek√∫torom. Pr√≠klad tak√©ho pl√°nu:</p><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/plan-1920w.avif 1920w, /img/plan-1280w.avif 1280w, /img/plan-640w.avif 640w, /img/plan-320w.avif 320w" type="image/avif"><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/plan-1920w.webp 1920w, /img/plan-1280w.webp 1280w, /img/plan-640w.webp 640w, /img/plan-320w.webp 320w" type="image/webp"><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/plan-1920w.png 1920w, /img/plan-1280w.png 1280w, /img/plan-640w.png 640w, /img/plan-320w.png 320w" type="image/png"><img src="/img/plan-1920w.png" alt="Pr√≠klad pl√°nu" decoding="async" height="251" loading="lazy" style="background-size:cover;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 691 251'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAFCAYAAACeuGYRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6ElEQVQYlRWPyU3FMBgGUxOiA65UgUREA1ACEldOwI0jHfAOtABHEI8lToKSOIsdb3nOb/tDKWBmNNn3ewFejbuxVufFZwW2rzFUMufleP/zwdAUXA5MHbVs4OVXjf0ri5k2CgB2fT9cKq2gjUagkCekB2M1QgxCSX0qpZQJEf3flDLnHJx1b7zltykBRAHkw1mKuDPGwFpni192rWalUoro2JAyKSXEJF7Ih3xdVyxuwSzmK2fdoxAC0zQZ3vQngQKPKaArx5QdDofN/kw+XGyQtRZt090sbnnyqwcRSW/pmFbqt4+t9A/WDuvNY7Q2rgAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&quot;)" width="691"></picture></p><p>Na etapu 1 nadv√§zuje etapa 2, etapa 3 je nez√°visl√° na nich a m√¥≈æe be≈æa≈• paralelne, v etape 4 sa spoja RDD z et√°p 2 a 3.</p><h3 id="spark-sql">Spark SQL <a href="#spark-sql" class="direct-link">#</a></h3><p>Spark SQL priniesol d√°tov√∫ abstrakciu naz√Ωvan√∫ DataFrame, t√°to poskytuje podporu pre ≈°trukt√∫rovan√© a semi≈°trukt√∫rovan√© d√°ta (JSON).<br>DataFrame je distribuovan√° kolekcia objektov typu Row organizovan√° do pomenovan√Ωch stƒ∫pcov, koncepƒçne zodpoved√° tabuƒæke v relaƒçnej datab√°ze.<br>DataFramy s√∫ takisto ako RDD nemenn√©.<br>Spark SQL poskytuje ≈°tandardn√© rozhranie pre ƒç√≠tanie d√°t z a zapisovanie do r√¥znych d√°tov√Ωch √∫lo≈æ√≠sk vr√°tane JSON a CSV s√∫borov, Apache Hive, JDBC, Apache Avro, Apache Parquet, existuj√∫ aj connectory pre MongoDB atƒè.<br>Spark SQL umo≈æ≈àuje dotazova≈• d√°ta v r√°mci Spark aplik√°ci√≠ s pou≈æit√≠m DataFrame API alebo SQL dotazov (sl√∫≈æi ako distribuovan√Ω SQL query engine).</p><p>Uk√°≈æka DataFrame API vs SQL:</p><pre class="language-scala"><code class="language-scala">spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>table<span class="token punctuation">(</span><span class="token string">"published_mediabi.clicks"</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span>where<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"dt"</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">"2020-12-08"</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span>agg<span class="token punctuation">(</span>sum<span class="token punctuation">(</span><span class="token string">"clicks"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><br>spark<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token string">"SELECT SUM(clicks) FROM published_mediabi.clicks WHERE dt = '2020-12-08'"</span><span class="token punctuation">)</span></code></pre><h3 id="spark-shell">Spark Shell <a href="#spark-shell" class="direct-link">#</a></h3><p>Na r√Ωchle ad-hoc anal√Ωzy, prototypovanie a testovanie sa pou≈æ√≠va Spark shell.<br>Ak si chcete Spark prakticky vysk√∫≈°a≈• na lok√°lnom poƒç√≠taƒçi, je to mo≈æn√© pr√°ve v tejto konzole (staƒç√≠ ma≈• nain≈°talovan√∫ Javu), po <a href="https://spark.apache.org/downloads.html">stiahnut√≠</a> ju spust√≠te z rozbalen√©ho adres√°ra pr√≠kazom</p><pre class="language-bash"><code class="language-bash">./bin/spark-shell</code></pre><ul><li>v r√°mci konzoly funguje automatick√© dokonƒçovanie pomocou <code>TAB</code></li><li>pomoc zobraz√≠me <code>:help</code></li><li>hist√≥riu pr√≠kazov <code>:history</code></li><li>do paste m√≥du pre vlo≈æenie viacriadkov√©ho kusu k√≥du sa dostaneme <code>:paste</code> (a von z neho <code>CTRL</code>+<code>D</code>)</li><li>Scala skript m√¥≈æeme naƒç√≠ta≈• <code>:load &lt;cesta k s√∫boru&gt;</code></li><li>pr√°cu v konzole ukonƒç√≠me <code>:quit</code></li></ul><p>Spark shell pri spusten√≠ vytvor√≠:</p><ol><li>premenn√∫ <mark>sc</mark> pre pr√≠stup k SparkContextu (vstupn√Ω bod Spark Core funkcionality)</li><li>premenn√∫ <mark>spark</mark> pre pr√≠stup k SparkSession (vstupn√Ω bod Spark SQL funkcionality)</li></ol><p>Pr√≠klady naƒç√≠tania d√°t:</p><pre class="language-scala"><code class="language-scala">spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>parquet<span class="token punctuation">(</span><span class="token string">"/data/staged/ott/mediabi/googledfp/NetworkImpressions/dt=20201209"</span><span class="token punctuation">)</span><br>spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"header"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>csv<span class="token punctuation">(</span><span class="token string">"/data/staged/media/scv/bluekai_insights_categories/dt=20201209"</span><span class="token punctuation">)</span><br>spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>table<span class="token punctuation">(</span><span class="token string">"staged_mediabi.dfp_etl_status"</span><span class="token punctuation">)</span></code></pre><p>Spustenie pr√≠kladov pribalen√Ωch k in≈°tal√°cii Sparku a cel√∫ dokument√°ciu n√°jdete na <a href="https://spark.apache.org/docs/latest/#running-the-examples-and-shell">https://spark.apache.org/docs/latest/#running-the-examples-and-shell</a></p><center><h3>üôè üôè üôè</h3></center><p>Ak ste sa dostali a≈æ sem a pr√≠spevok sa V√°m p√°ƒçil, jeho <a href="https://monikajassova.github.io/posts/spark/" on-click="share">zdieƒæanie</a> na Va≈°ej obƒæ√∫benej soci√°lnej sieti ma veƒæmi pote≈°√≠ üíñ!</p><share-widget><button aria-label="Share" href="https://monikajassova.github.io/posts/spark/" on-click="share"><div></div></button></share-widget><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Apache Spark","image":["https://monikajassova.github.io/img/SparkEcosystem-1920w.png","https://monikajassova.github.io/img/plan-1920w.png"],"author":"Monika Ja≈°≈°ov√°","genre":"Blog","publisher":{"@type":"Organization","name":"Monika Ja≈°≈°ov√°","logo":{"@type":"ImageObject","url":"/img/favicon/favicon-192x192.png?hash=f78a2bf32c"}},"url":"https://monikajassova.github.io/posts/spark/","mainEntityOfPage":"https://monikajassova.github.io/posts/spark/","datePublished":"2022-05-21","dateModified":"2022-10-21","description":"Zbe≈æn√Ω prehƒæad fungovania Apache Spark Apache Spark je jedn√Ωm z najpou≈æ√≠vanej≈°√≠ch n√°strojov pre anal√Ωzu d√°t vo veƒækej ≈°k√°le (big data),..."}</script><p>D√°tum publikovania: <time datetime="2022-05-21">21. m√°j 2022</time></p></article></main><footer>¬© Monika Ja≈°≈°ov√°, 2022</footer></body></html>
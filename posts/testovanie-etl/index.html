<!DOCTYPE html><html class="no-js" domain="github.io" lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><link href="/img/favicon/favicon-192x192.png?hash=f78a2bf32c" rel="icon" type="image/png"><meta content="79b473" name="theme-color" media="(prefers-color-scheme: light)"><meta content="f9c412" name="theme-color" media="(prefers-color-scheme: dark)"><meta content="max-snippet:-1, max-image-preview: large, max-video-preview: -1" name="robots"><title>Testovanie ETL</title><meta content="Testovanie ETL" property="og:title"><meta content="Zop√°r bodov k testovaniu ETL procesov v big data." name="description"><meta content="Zop√°r bodov k testovaniu ETL procesov v big data." property="og:description"><meta content="https://monikajassova.github.io/img/remote/Zd4vr8.png" property="og:image"><link href="https://monikajassova.github.io/posts/testovanie-etl/" rel="canonical"><meta content="no-referrer-when-downgrade" name="referrer"><link href="/feed/feed.xml" rel="alternate" type="application/atom+xml" title="Domov"><link href="/" rel="preconnect" crossorigin=""><link href="/fonts/Inter-3.19.var.woff2" rel="preload" type="font/woff2" as="font" crossorigin=""><script csp-hash="sha256-XwWdy3h8RLzX10dUs9n/fCAkQc+XFysyIb7c80Ymdkw=">document.documentElement.classList.remove("no-js");</script><script async="" defer="" src="/js/min.js?hash=639a113458"></script><script async="" defer="" src="/js/goatCounter.js" data-goatcounter="https://miti.goatcounter.com/count"></script><script csp-hash="sha256-dV8AqTFq+DEHvrcvFtA7Q4feFxe8sPFUc57DVH84EjE=">(function (){const docElm=document.documentElement; const modeKey="colorscheme-mode"; let mode=undefined; try{mode=window.localStorage.getItem(modeKey); if (mode){docElm.setAttribute(modeKey, mode);}else{mode=((window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) ? "light" : "dark"); docElm.setAttribute(modeKey, mode); window.localStorage.setItem(modeKey, mode);}}catch (exception){mode=((window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) ? "light" : "dark"); docElm.setAttribute(modeKey, mode);}})()</script><script csp-hash="sha256-Ky9qZOPnMhQV/s7Fdb9TYAOfU4KtWNqCZaFK8tSzXa0=">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--switch-shadow-color: #f7f7f7;--switch-icon: "üåö";--switch-text: "Tmav√Ω?";--text-color: #222222;--bg-color: #f7f7f7;--theme-color: #79b473;--primary: var(--theme-color);--primary-dark: #89b485}:root[colorscheme-mode=dark]{--switch-shadow-color: #0e0d0c;--switch-icon: "üåù";--switch-text: "Svetl√Ω?";--text-color: #e5e5e5;--bg-color: #181818;--theme-color: #f9c412;--primary: var(--theme-color);--primary-dark: #e7bf60}@media (prefers-color-scheme:light){:root:not([colorscheme-mode=dark]){--switch-shadow-color: #f7f7f7;--switch-icon: "üåö";--switch-text: "Tmav√Ω?";--text-color: #222222;--bg-color: #f7f7f7;--theme-color: #79b473;--primary: var(--theme-color);--primary-dark: #89b485}}@media (prefers-color-scheme:dark){:root:not([colorscheme-mode=light]){--switch-shadow-color: #0e0d0c;--switch-icon: "üåù";--switch-text: "Svetl√Ω?";--text-color: #e5e5e5;--bg-color: #181818;--theme-color: #f9c412;--primary: var(--theme-color);--primary-dark: #e7bf60}}.no-js .colorscheme-toggle-label{display:none}.colorscheme-toggle-label{--transition-time: 0.3s;cursor:pointer;display:inline-block;transition:all var(--transition-time) ease-in-out;transform:scale(1.2)}.colorscheme-toggle-label::before{content:var(--switch-icon);transition:text-shadow var(--transition-time);text-shadow:0 0 10px var(--switch-shadow-color)}.colorscheme-toggle-label::after{align-self:center;vertical-align:baseline;content:var(--switch-text);color:#222;font-weight:lighter;font-size:.75em;text-align:center;opacity:0;padding-left:15x;margin-left:10px;transition:opacity var(--transition-time)}.colorscheme-toggle-label:hover::before{text-shadow:0 0 10px var(--switch-shadow-color)}.colorscheme-toggle-label:hover::after{opacity:1}main img{content-visibility:auto}article *{scroll-margin-top:50px}header nav{z-index:1;position:fixed;top:0;left:0;width:100vw;padding:.375em 1.5em;background:rgba(255,255,255,.9);font-weight:200;text-align:right}:root{--main-width: calc(100vw - 3em)}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)}}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px}share-widget div{width:30px;height:30px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center}.apple share-widget div{background-image:url(/img/share-apple.svg)}body,share-widget button{margin:0}share-widget button:active{transform:scale(1.2)}dialog{background-color:#ab7390;z-index:1000}header aside{font-style:italic}#nav{z-index:2;position:relative}#reading-progress{z-index:1;background-color:var(--primary);width:100vw;position:absolute;left:0;top:0;bottom:0;transform:translate(-100vw,0);will-change:transform;pointer-events:none}#posts li{margin-bottom:.5em}@font-face{font-display:optional;font-family:"Inter UI";font-weight:100 900;font-style:oblique 0deg 10deg;src:url(/fonts/Inter-3.19.var.woff2) format("woff2")}button,html{line-height:1.15}html{-webkit-text-size-adjust:100%;font-family:Inter UI,sans-serif;--font-family: Inter UI, sans-serif}body{transition:all 300ms ease-in-out 0s}h1{font-size:3em;line-height:1.25;margin:.67em 0 .5em;font-size:2.074rem;line-height:2.4rem;margin-bottom:1.36rem}a{background-color:transparent;color:#f9c412;text-decoration:none;color:var(--primary)}b{font-weight:700}img{border-style:none;max-width:100%;height:auto;margin:0 auto}button{font-family:inherit;font-size:100%;overflow:visible;text-transform:none}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}h3{font-size:2em;line-height:1.125;margin-bottom:.75em;font-size:1.4rem;line-height:1.6rem;margin-bottom:1.36rem}body,ol,p,pre,ul{font-size:1em}form,ol,p,pre,ul{margin-bottom:1.5em}body,ol,p,pre,ul{font-size:1rem;line-height:1.6}ol,p,pre,ul{margin-bottom:1.36rem}@media (min-width:600px){h1{font-size:4.3978rem;line-height:4.4rem}h3{font-size:2.1989rem;line-height:2.64rem}body,ol,p,pre,ul{font-size:1.1rem;line-height:1.6}h1,h3,ol,p,pre,ul{margin-bottom:1.496rem}}@media (min-width:1200px){h1{font-size:6.0756rem;line-height:6.72rem}h3{font-size:2.7rem;line-height:2.88rem}body,ol,p,pre,ul{font-size:1.2rem;line-height:1.6}h1,h3,ol,p,pre,ul{margin-bottom:1.632rem}}pre{overflow-x:auto;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}mark{background:#f9c412;padding:0 .3em;background:var(--primary)}h1,h3{font-family:var(--font-family)}a:hover{text-decoration:underline}form{padding:1.5em 1.5em 0;border:.2rem solid #202020}button{border-radius:.3em;max-width:100%;background:#f2f2f2;color:#191919;cursor:pointer;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button+label,label+*{page-break-before:always}button,label{display:inline-block}form>:not(fieldset){margin-right:.75em}button:hover{background:#d9d9d9;color:#000}button:not([disabled]){background:#f9c412;color:#181818;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}*{border:0;box-sizing:border-box}body,header nav a{font-family:var(--font-family)}body{background:var(--bg-color);color:var(--text-color)}header label{display:block}header{padding:4.5em 1.5em 3em;width:37.5em;margin:0 auto;text-align:center;max-width:100%;display:flex;align-items:center;flex-direction:column}header p,ol,ul{margin-top:0}header nav h1{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav a{font-weight:700;text-decoration:none;color:#181818;margin-left:1.5em}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}header nav label{color:#000;cursor:pointer;margin:0;font-style:normal;text-align:right}main{max-width:70rem;margin:0 auto;border-top:.5px solid #ccc;text-align:justify}footer{background:rgba(0,0,0,.8);color:#fff;padding:3em;text-align:center}footer>*{margin:1.5em}footer nav a img{vertical-align:middle}footer nav,footer p{font-size:90%}article{max-width:100%;padding:1.5em;width:40em;margin:0 auto}li ol,li ul{margin-bottom:0}</style></head><body><header><nav><div id="nav"><h1><a href="/" title="Homepage">Domov</a> <label class="colorscheme-toggle-label" id="colorscheme-toggle" on-click="colorscheme-toggle"></label></h1><a href="/tags/">Tagy</a> <a href="/about/">O mne</a></div><div id="reading-progress" aria-hidden="true"></div></nav><h1>Testovanie ETL</h1><aside>ƒç√≠tanie na 9 min</aside><dialog id="message"></dialog><noscript><img src="https://miti.goatcounter.com/count?p=/test-noscript"></noscript></header><main><article><p><em>Cieƒæom tohto ƒçl√°nku je zosumarizova≈• postupy, ktor√© som implementovala pri testovan√≠ ETL procesov a s ktor√Ωmi som sa stretla v r√°mci big data</em></p><h3 id="%C3%BAvod-do-big-data-a-etl">√övod do big data a ETL <a href="#%C3%BAvod-do-big-data-a-etl" class="direct-link">#</a></h3><p>Veƒæk√© d√°ta (ƒèalej big data) s√∫ charakterizovan√© troma V:</p><ol><li>volume - veƒæk√Ω objem d√°t,</li><li>velocity - r√Ωchlos≈• s akou s√∫ produkovan√© (gigabajty nov√Ωch d√°t denne),</li><li>variety - d√°ta prich√°dzaj√∫ z r√¥znych zdrojov a v r√¥znej forme.</li></ol><p>S√∫ to tak√© veƒæk√© s√∫bory d√°t, ≈æe ich nie je mo≈æn√© uchov√°va≈•, spravova≈• a spracov√°va≈• be≈æne pou≈æ√≠van√Ωmi softv√©rov√Ωmi prostriedkami v rozumnom ƒçase.<br>√ölohou d√°tov√Ωch in≈æinierov je spracovanie big data a ich pr√≠prava do po≈æadovanej podoby pre ƒèal≈°√≠ch pou≈æ√≠vateƒæov d√°t - spravidla d√°tov√Ωch analytikov, d√°tov√Ωch vedcov.</p><p>Jeden z procesov, ktor√Ωm sa to deje, sa naz√Ωva <mark>ETL</mark> (extract-transform-load).<br>V prvej f√°ze ETL sa d√°ta extrahuj√∫ zo zdrojov - s≈•ahuj√∫ sa z FTP serverov, cloudov√Ωch √∫lo≈æ√≠sk, dotazuj√∫ sa cez REST API a pod. Surov√© d√°ta m√¥≈æu ma≈• r√¥znu ≈°trukt√∫ru - tabuƒæky v relaƒçn√Ωch datab√°zach, z√°znamy v NoSQL datab√°zach, s√∫bory form√°tu CSV, XML, JSON atƒè.<br>Poƒças f√°zy transform√°cie sa d√°ta upravuj√∫ podƒæa po≈æadovan√Ωch pravidiel, filtruj√∫, oƒçis≈•uj√∫, sp√°jaj√∫ s in√Ωmi d√°tami, prev√°dzaj√∫ sa nad nimi agreg√°cie alebo in√© v√Ωpoƒçty. Tieto medziv√Ωsledky sa dr≈æia v oblasti staged.<br>V z√°vereƒçnej f√°ze sa fin√°lne d√°ta publikuj√∫ na dohodnutom mieste, spravidla v d√°tovom sklade (data warehouse - DWH), kde ich priamo alebo cez connectory vedia pou≈æ√≠vatelia dotazova≈•, pracova≈• s nimi, vyu≈æi≈• ako podklad pre analytick√© a BI (business intelligence) n√°stroje.</p><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/etl-1920w.avif 1920w, /img/etl-1280w.avif 1280w, /img/etl-640w.avif 640w, /img/etl-320w.avif 320w" type="image/avif"><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/etl-1920w.webp 1920w, /img/etl-1280w.webp 1280w, /img/etl-640w.webp 640w, /img/etl-320w.webp 320w" type="image/webp"><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/etl-1920w.png 1920w, /img/etl-1280w.png 1280w, /img/etl-640w.png 640w, /img/etl-320w.png 320w" type="image/png"><img src="/img/etl-1920w.png" alt="ETL proces" decoding="async" height="301" loading="lazy" style="background-size:cover;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 686 301'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAFCAYAAABxeg0vAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAElEQVQImQH1AAr/AIGBgZyCgoJErpSlANCjwADOor8Ay6G9ANKkwgCij5wAf4F7ANa0TQH+ugAA+KoaAACEgoMacXp0D7yasCLPor81zKG9MsuhvTHSpMI2oY+bJICCeynUs00A4qoAI+ypIjEAi4WJGAA9AAbBnLR2yZ+6+8Wct+vFnbfox5y4/aWQnq9+gXug//8AAH58fMTprjyaAIOCgh91fHgRuZmuHc+jwCjMob0nzKG9JdGjwSqlkZ4Xen96Ff8A/wBPacsxfub/BwCBgYE7g4KCIe2v1wDKobwAz6K/AMyhvQDRo8EApJCeAHt/ewB1/wAAT2fGAJrX8gCPs3otPzZ/8AAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&quot;)" width="686"></picture></p><p>Nov≈°√≠m pr√≠stupom je <mark>ELT</mark> (extract-load-transform) proces, pri ktorom sa surov√© d√°ta nahraj√∫ na cieƒæov√Ω syst√©m a transform√°cie sa vykon√°vaj√∫ a≈æ tam, napr. s pomocou n√°stroja <a href="https://www.getdbt.com">dbt</a>.</p><p>ETL procesy m√¥≈æu prebieha≈•:</p><ul><li>d√°vkovo - <mark>batch processing</mark>, kedy s√∫ sp√∫≈°≈•an√© periodicky, riaden√© orchestr√°torom</li><li>ako <mark>streaming</mark>, kedy s√∫ d√°ta sprac√∫van√© v re√°lnom ƒçase ako prich√°dzaj√∫ do syst√©mu</li></ul><p>Na na≈°om projekte sme uplat≈àovali batch processing a ako orchestr√°tor pre definovanie workflowow a pl√°novanie ich behov sme pou≈æ√≠vali <a href="https://oozie.apache.org">Oozie</a> a nesk√¥r aj <a href="https://airflow.apache.org">Airflow</a>. Uk√°≈æka ako tak√Ω workflow m√¥≈æe vyzera≈• (<a href="https://www.aakashpydi.com/jetstream-architecture/">zdroj obr√°zka</a>):</p><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/airflow-1920w.avif 1920w, /img/airflow-1280w.avif 1280w, /img/airflow-640w.avif 640w, /img/airflow-320w.avif 320w" type="image/avif"><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/airflow-1920w.webp 1920w, /img/airflow-1280w.webp 1280w, /img/airflow-640w.webp 640w, /img/airflow-320w.webp 320w" type="image/webp"><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/airflow-1920w.png 1920w, /img/airflow-1280w.png 1280w, /img/airflow-640w.png 640w, /img/airflow-320w.png 320w" type="image/png"><img src="/img/airflow-1920w.png" alt="Workflow v Airflow" decoding="async" height="612" loading="lazy" style="background-size:cover;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1097 612'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAk0lEQVQImY2LywqDMBQF88kFV0ai/UqVCjWNJiY+oqvS3RRD3ffAZbjDOeKWZRRKUVZ3VFWhyhJZFORSksuLErG+P/wTccTIse8c+5G4/+5y1y8eQ4d2GucdfvYs60JYZlxwWG+T27YN0ZiGznYYbxjCgHGGp+1ph5b6VaMnTYwRob1OpXMZlpDkydP3U88YxlT8AtB81H4J+RJIAAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&quot;)" width="1097"></picture></p><p>Na samotn√© sprac√∫vanie d√°t sme pou≈æ√≠vali Apache Spark, o ktorom som p√≠sala <a href="/posts/spark">v tomto pr√≠spevku</a>. Pre predstavu na akom HW Spark a Hadoop be≈æal, i≈°lo o Oracle BDA/HDFS cluster o 12 uzloch (ka≈æd√Ω s procesorom Intel XEON), ktor√Ω dokopy disponoval 1 TB RAM a 900 TB HDD.</p><p>Testovanie a zabezpeƒçenie kvality ETL procesov bolo n√°pl≈àou mojej pr√°ce v DAZN. Keƒè som nast√∫pila, big data boli pre m≈àa nov√© a netu≈°ila som, ako to budem testova≈•. Online zdrojov k t√©me testovania d√°t je poskromne aj teraz a keƒè som zaƒç√≠nala, nach√°dzala som len odkazy na platen√© n√°stroje, ale m√°loƒço o konkr√©tnych met√≥dach. N√°zvy testov v nasleduj√∫com texte s√∫ intern√© oznaƒçenia, nejde o odborn√∫ terminol√≥giu.</p><h3 id="d%C3%A1tov%C3%A9-e2e-testy">D√°tov√© E2E testy <a href="#d%C3%A1tov%C3%A9-e2e-testy" class="direct-link">#</a></h3><p>Prv√Ωm krokom pri zaveden√≠ automatizovan√©ho testovania jednotliv√Ωch ETL procesov bolo vytvorenie nieƒçoho ako E2E testov nad fixn√Ωmi d√°tami. V prostred√≠ som vytvorila osobitn√© prieƒçinky, kde som si pripravila s√∫bory s testovac√≠mi d√°tami po vzore re√°lnych. Mal√∫ vzorku, tak aby som mala kontrolu nad t√Ωm, ƒço v nej je a ƒço sa s ≈àou deje. Pripravila som d√°ta pre r√¥zne testovacie pr√≠pady, tzv. happy path aj okrajov√© pr√≠pady, ƒçi sa do v√Ωsledku dost√°vaj√∫ skutoƒçne tie d√°ta, ktor√© maj√∫.<br>Nad t√Ωmito d√°tami som p√∫≈°≈•ala workflowy, ktor√© ich spracovali a na konci sa v√Ωsledn√© d√°ta porovnali s oƒçak√°van√Ωm v√Ωsledkom. Automatizovan√Ω test alebo pomocn√Ω skript na z√°ver v≈°etky v√Ωsledn√© d√°ta aj medziv√Ωsledky ETL procesu zmazal a pripravil prostredie na ƒèal≈°√≠ beh cel√©ho testovacieho workflowu.<br>Ak bol ETL proces jednoduch√Ω a napr. zabezpeƒçoval len, aby sa v published dr≈æala najnov≈°ia verzia z√°znamu, automatizovan√© testy be≈æali na produkƒçn√Ωch d√°tach a porovn√°vali vstupn√© d√°ta s v√Ωstupn√Ωmi.</p><p>E2E testy pomohli vyrie≈°i≈• z√°hadn√Ω bug - mala som podozrenie, ≈æe obƒças maj√∫ niektor√© z√°znamy ist√© hodnoty dvojn√°sobn√© ako by mali by≈•, ale nevedeli sme kedy a preƒço sa tak deje. A≈æ keƒè som sa dostala k nasimulovaniu cel√©ho procesu a d√°t, tak som zistila, ≈æe v ≈°pecifickom pr√≠pade, keƒè d√°ta spadali do dvoch kateg√≥ri√≠, tieto sa zapoƒç√≠tali dvakr√°t.</p><h3 id="testy-konzistentnosti">Testy konzistentnosti <a href="#testy-konzistentnosti" class="direct-link">#</a></h3><p>ƒéal≈°ou skupinou automatizovan√Ωch testov boli testy, ktor√© zis≈•ovali, ƒçi s√∫ produkƒçn√© d√°ta konzistentn√© z hƒæadiska logiky dom√©ny. Pr√≠klad z digit√°lneho marketingu: poƒçet kliknut√≠ na reklamu mus√≠ by≈• men≈°√≠ ako poƒçet viden√≠ a ten zas men≈°√≠ ako poƒçet po≈æiadaviek o reklamu odoslan√Ωch serveru.</p><p>Testy konzistentnosti sme vo veƒækom vyu≈æili pri implement√°cii produktu single customer view v grafovej datab√°ze Neo4j. Grafov√° datab√°za je koncept umo≈æ≈àuj√∫ci jednoducho modelova≈• vz≈•ahy re√°lne existuj√∫ce v dom√©ne. Uk√°≈æka vz≈•ahov medzi r√¥znymi uzlami a dopytovacieho jazyka Cypher:</p><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/cypher-1920w.avif 1920w, /img/cypher-1280w.avif 1280w, /img/cypher-640w.avif 640w, /img/cypher-320w.avif 320w" type="image/avif"><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/cypher-1920w.webp 1920w, /img/cypher-1280w.webp 1280w, /img/cypher-640w.webp 640w, /img/cypher-320w.webp 320w" type="image/webp"><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/cypher-1920w.png 1920w, /img/cypher-1280w.png 1280w, /img/cypher-640w.png 640w, /img/cypher-320w.png 320w" type="image/png"><img src="/img/cypher-1920w.png" alt="Neo4j" decoding="async" height="641" loading="lazy" style="background-size:cover;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1313 641'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAFCAYAAACTphZWAAAACXBIWXMAABJ0AAASdAHeZh94AAAAqUlEQVQImSXNzU7DMBAA4bz/oyHBgQMVFS0UiJs0zb/t9a6dDKq4zemb6vnphbHp6Y4fNJcjv+eaw6Xj++eN2n3impaTG1iGhWpZI8kyksHfD4TpytUbr/cVS8b77cwcI2obVZCE7TDfWvzYM3th7ickGSFlYi4kK2jeqJJmDPBu4OvUMXnBtyMx78jQoV2N7qBWHrISRQmPpfOs0dCyIVaQEJB1+W81/gBHVtH1hYyfYQAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&quot;)" width="1313"></picture></p><p>Testy overovali, ƒçi skutoƒçn√Ω stav zodpoved√° navrhnut√©mu d√°tov√©mu modelu grafu - ƒçi s√∫ spr√°vne vlastnosti uzlov a vz≈•ahov, ƒçi nie s√∫ vz≈•ahy duplicitn√©, ƒçi sa v grafe nenach√°dzaj√∫ entity po TTL (time-to-live). Testy konzistentnosti n√°m pomohli n√°js≈• chyby v implement√°cii grafu, identifikova≈• veci, ktor√© sme doposiaƒæ pri implement√°cii neo≈°etrili a tie≈æ skryt√© zlyhania workflowov.</p><h3 id="monitoring">Monitoring <a href="#monitoring" class="direct-link">#</a></h3><p>Tret√≠m pilierom, ktor√Ω n√°m veƒæmi pomohol odhaƒæova≈• probl√©my a anom√°lie a zv√Ω≈°i≈• d√¥veru vo fungovanie na≈°ich ETL procesov, bolo nastavenie monitoringu metr√≠k t√Ωkaj√∫cich sa d√°t a samotn√Ωch ETL procesov. Pou≈æili sme na to <a href="https://www.elastic.co/kibana">Kibanu</a> od Elasticu (existuje veƒæa alternat√≠v, napr. open-source <a href="https://grafana.com">Grafana</a>). Vytypovali sme metriky, ktor√© sa op√§≈• periodicky sp√∫≈°≈•ali ako Spark aplik√°cie (metriky t√Ωkaj√∫ce sa s√∫borov na HDFS a tabuliek v Hive), Scala aplik√°cie (metriky t√Ωkaj√∫ce sa grafu v Neo4j a workflowov v Oozie) alebo bash skripty (metriky t√Ωkaj√∫ce sa tabuliek v BigQuery) a zaznamen√°vali hodnoty v logoch pre Kibanu.</p><p align="center"><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/metric-1920w.avif 1920w, /img/metric-1280w.avif 1280w, /img/metric-640w.avif 640w, /img/metric-320w.avif 320w" type="image/avif"><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/metric-1920w.webp 1920w, /img/metric-1280w.webp 1280w, /img/metric-640w.webp 640w, /img/metric-320w.webp 320w" type="image/webp"><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/metric-1920w.png 1920w, /img/metric-1280w.png 1280w, /img/metric-640w.png 640w, /img/metric-320w.png 320w" type="image/png"><img src="/img/metric-1920w.png" alt="Metrika v Kibane" decoding="async" height="328" loading="lazy" style="background-size:cover;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 537 328'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAIAAAB1kpiRAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAVklEQVQImW2OQQ4CUQxC//3vq1MoBdNxYTS+sIIQOACeVSABVuFRF9VJWqL6eAZEDd/i9HiSUA3i8O4l8cr55ly1/Lif2Da57f9xEo3ucy0JCwHYO/QCWhixfGZQOvMAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&quot;)" width="537"></picture></p><p>I≈°lo napr. o poƒçet modifikovan√Ωch uzlov v dan√Ω de≈à (na obr√°zku vy≈°≈°ie); veƒækos≈• surov√Ωch d√°t, ktor√© sa stiahli dan√Ω de≈à; sumy z√°znamov vo v√Ωsledn√Ωch d√°tach; dƒ∫≈æku trvania ETL procesu.<br>Do Kibany reportovali v√Ωsledky aj testy, ktor√© kontrolovali, ƒçi s√∫ pr√≠tomn√© d√°ta z ka≈ædej hodiny d≈àa, ƒçi boli v≈°etky surov√© d√°ta spracovan√©, ƒçi v≈°etky staged d√°ta boli publikovan√© a ƒçi sa na HDFS nenach√°dzaj√∫ star√© s√∫bory, ktor√© mali by≈• vymazan√© po uplynut√≠ doby retencie d√°t. Nastavila som alerty, aby sme boli o tak√Ωchto udalostiach notifikovan√≠ emailom.</p><h3 id="kvalita-d%C3%A1t%2C-katal%C3%B3g-d%C3%A1t-a-spol.">Kvalita d√°t, katal√≥g d√°t a spol. <a href="#kvalita-d%C3%A1t%2C-katal%C3%B3g-d%C3%A1t-a-spol." class="direct-link">#</a></h3><p>Testy boli hotov√© - vy≈æadovali len √∫dr≈æbu, monitoring fiƒçal, tak som zaƒçala re≈°er≈°ova≈•, ak√© vychyt√°vky by sa e≈°te dali zaradi≈• a t√Ωm dvihn√∫≈• kvalitu na≈°ich ETL procesov na e≈°te vy≈°≈°iu √∫rove≈à. Bohu≈æiaƒæ, k sk√∫senostiam s nasledovn√Ωmi n√°strojmi z prvej ruky som sa u≈æ nedostala, keƒè≈æe priority na projekte sa presunuli smerom od big data a nesk√¥r som zmenila p√¥sobisko.</p><p>Profilovanie d√°t je proces sk√∫mania zdrojov√Ωch d√°t a porozumenia ich ≈°trukt√∫re, obsahu a vz√°jomn√Ωch vz≈•ahov s cieƒæom identifikovania potenci√°lu pre d√°tov√© projekty. V√Ωsledky testovania, monitoringu a profilovania a ich sprievodn√© vizualiz√°cie m√¥≈æu pom√¥c≈• identifikova≈• vzory v d√°tach a pr√≠le≈æitosti prepojenia datasetov, znaƒçkovania a pridania metad√°t s cieƒæom lep≈°ie identifikova≈• a kategorizova≈• inform√°cie v organiz√°cii.</p><p>N√°stroje na kvalitu d√°t umo≈æ≈àuj√∫ anal√Ωzu datasetu, valid√°ciu d√°t, profilovanie d√°t, odhalenie nevalidn√Ωch (napr. duplicitn√© z√°znamy, hodnoty v stƒ∫pci nezodpovedaj√∫ce d√°tov√©mu typu alebo rozsahu hodn√¥t, v akom by mali by≈•), ch√Ωbaj√∫cich alebo neobvykl√Ωch d√°t. Nastavuj√∫ sa prahy akceptovan√Ωch parametrov pre d√°ta s dobrou kvalitou, oproti ktor√Ωm sa d√°ta testuj√∫ a pravidelne kontroluj√∫, ƒçi spƒ∫≈àaj√∫ vopred definovan√© pravidl√° a ≈°tandardy kvality. Z√°merom bolo zapoji≈• tak√©to testy do workflowu a zastavi≈• ƒèal≈°ie spracov√°vanie datasetu, ak by obsahoval zl√© d√°ta a t√Ωm zabr√°ni≈• zavedeniu zl√Ωch d√°t do published.<br>Pre tieto √∫ƒçely som na≈°la kni≈ænicu <a href="https://greatexpectations.io">Great Expectations</a>, nemohli sme ju v≈°ak pou≈æi≈• kv√¥li nekompatibilnej verzii Pythonu na na≈°om clusteri. Great Expectations umo≈æ≈àuje tie≈æ automatick√∫ dokument√°ciu d√°t. A≈æ nesk√¥r som objavila alternat√≠vy pre Scalu ako <a href="https://github.com/awslabs/deequ">Deequ</a>, <a href="https://github.com/FRosner/drunken-data-quality">DDQ</a>, <a href="https://github.com/databrickslabs/dataframe-rules-engine">DataFrame Rules Engine</a> a <a href="https://griffin.apache.org">Apache Griffin</a>. <a href="https://github.com/sodadata/soda-sql">Soda SQL</a> operuje nad d√°tami pr√≠stupn√Ωmi SQL, podporuje Amazon Redshift, Apache Hive a Spark, Snowflake a niekoƒæko DB a pravidl√° sa definuj√∫ v YAML form√°te. Umo≈æ≈àuje aj pou≈æ√≠vanie vlastn√Ωch metr√≠k.</p><p>Zauj√≠mavo sa javili aj n√°stroje na vytvorenie katal√≥gu d√°t <a href="https://www.amundsen.io">Amundsen</a> a na p√¥vod d√°t a vizualiz√°ciu procesov <a href="https://absaoss.github.io/spline">Apache Spline</a>. Katal√≥g d√°t sl√∫≈æi ako organizovan√Ω invent√°r d√°t pre d√°tov√Ωch in≈æinierov a pou≈æ√≠vateƒæov d√°t, kde m√¥≈æu na jednom mieste vyhƒæad√°va≈• d√°ta vhodn√© pre svoje potreby.</p><p>Pomocou m√¥≈æu by≈• aj rie≈°enia zalo≈æen√© na strojovom uƒçen√≠ (ML), ktor√© by sa natr√©novali na historick√Ωch d√°tach a odhaƒæovali anom√°lie v novopr√≠chodz√≠ch.</p><h3 id="z%C3%A1ver">Z√°ver <a href="#z%C3%A1ver" class="direct-link">#</a></h3><p>ETL procesy a ich testovanie s√∫ men≈°inov√° oblas≈• IT, ale maj√∫ svoje ƒçaro. Postupom ƒçasu zist√≠te, kde v≈°ade m√¥≈æe nasta≈• probl√©m. Niekoƒæko tak√Ωch tipov na ƒço si da≈• pozor:</p><ul><li>prehodenie hodn√¥t medzi dvoma stƒ∫pcami rovnak√©ho d√°tov√©ho typu</li><li>n√°hle zastavenie dod√°vania d√°t od tretej strany</li><li>n√°hla zmena sch√©my surov√Ωch d√°t</li><li>hodiny d√°t naviac a menej v d≈àoch prechodu na letn√Ω ƒças a sp√§≈•</li><li>uistite sa, ≈æe s≈•ahujete naozaj v≈°etky surov√© d√°ta z ich zdroja</li><li>uistite sa, ≈æe nahr√°vate naozaj v≈°etky spracovan√© d√°ta na cieƒæov√Ω syst√©m</li><li>pravidelne z√°lohujte d√°ta, m√¥≈æe sa sta≈•, ≈æe workflow vyma≈æe/pokaz√≠ ƒças≈• d√°t</li><li>dobr√© je aj pravidelne sledova≈• historick√© d√°ta v cieƒæovom syst√©me, m√¥≈æe sa sta≈•, ≈æe workflow vyma≈æe ƒças≈• d√°t, nahr√° d√°ta viackr√°t alebo prep√≠≈°e in√∫ part√≠ciu ako m√° a takto to m√¥≈æete zisti≈•</li><li>pozor na upgrady pou≈æ√≠van√Ωch n√°strojov. Spark 2.4 zmenil ako sa ukladaj√∫ pr√°zdne re≈•azce z CSV (null/pr√°zdny re≈•azec), ƒço malo vplyv na sp√°janie datasetov na dotknutom stƒ∫pci</li><li>ak beh workflowu prech√°dza cez polnoc (alebo in√∫ pre V√°s relevantn√∫ ƒçasov√∫ hranicu), uistite sa, ≈æe v≈°etky kroky workflowu pracuj√∫ s t√Ωmi batchmi d√°t, s ktor√Ωmi maj√∫</li></ul><center><h3>üôè üôè üôè</h3></center><p>Ak ste sa dostali a≈æ sem a pr√≠spevok sa V√°m p√°ƒçil, jeho <a href="https://monikajassova.github.io/posts/testovanie-etl/" on-click="share">zdieƒæanie</a> na Va≈°ej obƒæ√∫benej soci√°lnej sieti ma veƒæmi pote≈°√≠ üíñ!</p><share-widget><button aria-label="Share" href="https://monikajassova.github.io/posts/testovanie-etl/" on-click="share"><div></div></button></share-widget><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Testovanie ETL","image":["https://monikajassova.github.io/img/etl-1920w.png","https://monikajassova.github.io/img/airflow-1920w.png","https://monikajassova.github.io/img/cypher-1920w.png","https://monikajassova.github.io/img/metric-1920w.png"],"author":"Monika Ja≈°≈°ov√°","genre":"Blog","publisher":{"@type":"Organization","name":"Monika Ja≈°≈°ov√°","logo":{"@type":"ImageObject","url":"/img/favicon/favicon-192x192.png?hash=f78a2bf32c"}},"url":"https://monikajassova.github.io/posts/testovanie-etl/","mainEntityOfPage":"https://monikajassova.github.io/posts/testovanie-etl/","datePublished":"2022-06-07","dateModified":"2022-06-08","description":"Cieƒæom tohto ƒçl√°nku je zosumarizova≈• postupy, ktor√© som implementovala pri testovan√≠ ETL procesov a s ktor√Ωmi som sa stretla v r√°mci big..."}</script><p>D√°tum publikovania: <time datetime="2022-06-07">7. j√∫n 2022</time></p></article></main><footer>¬© Monika Ja≈°≈°ov√°, 2022</footer></body></html>